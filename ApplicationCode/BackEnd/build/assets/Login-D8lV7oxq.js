import{r as o,_ as b,R as S,b as k,c as I,P as u,o as w,l as E,q as P,j as e,v as L}from"./index-ZgVUef1k.js";import{b as R,c as x,a as G}from"./index.es-BuwcMwCe.js";import{a as B}from"./axios-B4uVmeYG.js";import{b as D}from"./config-6WvNVX-n.js";import{C as h}from"./CRow-BS3o19tv.js";import{C as g}from"./CCol-DppGgiLO.js";import{C as T,a as _}from"./CCardBody-DwN--fND.js";import{C as F}from"./CForm-CJBgKtX1.js";import{C,a as j}from"./CInputGroupText-DzGpvTUN.js";import{c as U,a as q}from"./cil-user-Dlmw-Gem.js";import{C as f}from"./CFormInput-5OO6EBiD.js";import"./CFormFeedback-9EUF2-zk.js";var m=o.forwardRef(function(s,t){var l=s.children,n=s.className,c=b(s,["children","className"]);return S.createElement("div",k({className:I("card-group",n)},c,{ref:t}),l)});m.propTypes={children:u.node,className:u.string};m.displayName="CCardGroup";const Y=({onLogin:s})=>{const[t,l]=o.useState(""),[n,c]=o.useState(""),[d,i]=o.useState(""),N=w(),p=E();o.useEffect(()=>{localStorage.removeItem("token"),p(P())},[]);const y=async r=>{r.preventDefault();try{const a=await B.post(`${D}/users/login`,{username:t,password:n});if(a.data.token){i(""),s(),console.log(a,"LOGIN RESP");const v={username:a.data.username,email:a.data.email,role:a.data.role};p(L({user:v,token:a.data.token})),localStorage.setItem("token",a.data.token),localStorage.setItem("username",a.data.username),localStorage.setItem("role",a.data.role),N(a.data.role==="admin"?"/dashboard":"/raiseDefects")}else i("Invalid credentials. Please try again.")}catch(a){i("Error logging in. Please try again."),console.error("Login error",a)}};return e.jsx("div",{className:"bg-body-tertiary min-vh-100 d-flex flex-row align-items-center",children:e.jsx(R,{children:e.jsx(h,{className:"justify-content-center",children:e.jsx(g,{md:6,children:e.jsx(m,{children:e.jsx(T,{className:"p-4",children:e.jsxs(_,{className:"text-center",children:[e.jsx("h1",{children:"Welcome Back!"}),e.jsx("p",{className:"text-body-secondary",children:"Please sign in to your account"}),d&&e.jsx("p",{className:"text-danger",children:d}),e.jsxs(F,{onSubmit:y,children:[e.jsxs(C,{className:"mb-3",children:[e.jsx(j,{children:e.jsx(x,{icon:U})}),e.jsx(f,{placeholder:"Email",autoComplete:"username",value:t,onChange:r=>l(r.target.value)})]}),e.jsxs(C,{className:"mb-4",children:[e.jsx(j,{children:e.jsx(x,{icon:q})}),e.jsx(f,{type:"password",placeholder:"Password",autoComplete:"current-password",value:n,onChange:r=>c(r.target.value)})]}),e.jsx(h,{children:e.jsx(g,{xs:12,children:e.jsx(G,{type:"submit",color:"primary",className:"px-4",children:"Login"})})})]})]})})})})})})})};export{Y as default};
