import{r as t,_ as b,R as S,b as k,c as I,P as u,o as w,l as E,q as P,j as e,v as L}from"./index-Dwn7C7aW.js";import{b as R,c as x,a as G}from"./index.es-BOuov5Dj.js";import{a as B}from"./axios-B4uVmeYG.js";import{C as D,a as T,b as _}from"./config-Cv2v05Rr.js";import{C as h,a as g}from"./CRow-B0qfBV7C.js";import{C as F}from"./CForm-CnrLQa8Q.js";import{C,a as j}from"./CInputGroupText-C-78UfCx.js";import{c as U,a as q}from"./cil-user-Dlmw-Gem.js";import{C as f}from"./CFormInput-BXy-4bnZ.js";import"./CFormFeedback-DWwcGZmJ.js";var m=t.forwardRef(function(s,o){var l=s.children,n=s.className,c=b(s,["children","className"]);return S.createElement("div",k({className:I("card-group",n)},c,{ref:o}),l)});m.propTypes={children:u.node,className:u.string};m.displayName="CCardGroup";const V=({onLogin:s})=>{const[o,l]=t.useState(""),[n,c]=t.useState(""),[d,i]=t.useState(""),N=w(),p=E();t.useEffect(()=>{localStorage.removeItem("token"),p(P())},[]);const y=async r=>{r.preventDefault();try{const a=await B.post(`${_}/users/login`,{username:o,password:n});if(a.data.token){i(""),s(),console.log(a,"LOGIN RESP");const v={username:a.data.username,email:a.data.email,role:a.data.role};p(L({user:v,token:a.data.token})),localStorage.setItem("token",a.data.token),localStorage.setItem("username",a.data.username),localStorage.setItem("role",a.data.role),N(a.data.role==="admin"?"/dashboard":"/raiseDefects")}else i("Invalid credentials. Please try again.")}catch(a){i("Error logging in. Please try again."),console.error("Login error",a)}};return e.jsx("div",{className:"bg-body-tertiary min-vh-100 d-flex flex-row align-items-center",children:e.jsx(R,{children:e.jsx(h,{className:"justify-content-center",children:e.jsx(g,{md:6,children:e.jsx(m,{children:e.jsx(D,{className:"p-4",children:e.jsxs(T,{className:"text-center",children:[e.jsx("h1",{children:"Welcome Back!"}),e.jsx("p",{className:"text-body-secondary",children:"Please sign in to your account"}),d&&e.jsx("p",{className:"text-danger",children:d}),e.jsxs(F,{onSubmit:y,children:[e.jsxs(C,{className:"mb-3",children:[e.jsx(j,{children:e.jsx(x,{icon:U})}),e.jsx(f,{placeholder:"Email",autoComplete:"username",value:o,onChange:r=>l(r.target.value)})]}),e.jsxs(C,{className:"mb-4",children:[e.jsx(j,{children:e.jsx(x,{icon:q})}),e.jsx(f,{type:"password",placeholder:"Password",autoComplete:"current-password",value:n,onChange:r=>c(r.target.value)})]}),e.jsx(h,{children:e.jsx(g,{xs:12,children:e.jsx(G,{type:"submit",color:"primary",className:"px-4",children:"Login"})})})]})]})})})})})})})};export{V as default};
