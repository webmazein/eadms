import{z as w,l as C,k as D,A as S,r as n,B as g,j as t}from"./index-ZgVUef1k.js";import{u as E}from"./index-CBpcUlIM.js";import{a as x}from"./axios-B4uVmeYG.js";import{w as v,b}from"./config-6WvNVX-n.js";import{C as N}from"./CRow-BS3o19tv.js";import{C as T,a as R,b as j,c as l,d as k,e as u}from"./CTable-CcN5PUBw.js";const W=()=>{const{id:m}=w(),h=C(),i=D(e=>S(e,m)),p=n.useRef(i),c=n.useRef(5),{sendMessage:z,lastMessage:d,readyState:M}=E(`${v}`,{onOpen:()=>console.log("WebSocket connection established"),onClose:()=>console.log("WebSocket connection closed"),onError:e=>console.error("WebSocket error:",e),shouldReconnect:e=>!0});n.useEffect(()=>{async function e(){try{const r=await x.get(`${b}/zone/getZoneRecordsForToday/${m}`);if(r.data.status===200){const{data:s}=r.data,a=[];s.forEach(o=>{a.push({id:o.id,defect_name:o.defect_name,defect_name_hi:o.defect_name_hi,station_id:o.station_id,screen_no:o.screen_no,operator_name:o.operator_name,updated_at:o.updated_at,count:1,is_updated:!1})}),h(g(a))}else toast.error("Failed to fetch zone records")}catch(r){console.error("Error fetching zone records:",r),toast.error("Failed to fetch zone records")}}e()},[]),n.useEffect(()=>{if(d!==null)try{const e=JSON.parse(d.data),r=e==null?void 0:e.data;if(r!=null&&r.length){const s=[];r.forEach(a=>{s.push({id:a.id,defect_name:a.defect_name,defect_name_hi:a.defect_name_hi,station_id:a.station_id,screen_no:a.screen_no,operator_name:a.operator_name,updated_at:a.updated_at,count:1,is_updated:!1})}),h(g([...i,...s]))}}catch(e){console.error("Error parsing message:",e)}},[d]),n.useEffect(()=>{if(d!==null)try{const e=JSON.parse(d.data);e.timer&&(c.current=e.timer,sessionStorage.setItem("alert_timer",e.timer))}catch(e){console.error("Error parsing WebSocket message:",e)}},[d]),n.useEffect(()=>{(async()=>{try{const r=await x.get(`${b}/settings/alert_timer`);r.status===200?(c.current=r.data.alert_timer,sessionStorage.setItem("alert_timer",r.data.alert_timer)):toast.error("Failed to fetch alert timer value")}catch(r){console.error("Error fetching alert timer:",r),toast.error("Failed to fetch alert timer value")}})()},[]);const f=n.useMemo(()=>{const e=new Map;return i.forEach(s=>{const a=p.current.find(_=>_.id===s.id),o=a?a.count!==s.count:!0;e.set(s.id,{...s,is_updated:o})}),Array.from(e.values()).sort((s,a)=>{const o=new Date(s.updated_at);return new Date(a.updated_at)-o})},[i,p]);n.useEffect(()=>{p.current=i},[i]);const y=e=>new Date(e).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});return t.jsxs("div",{className:"con",children:[t.jsxs("div",{className:"heading-container",style:{position:"relative",backgroundColor:"#f0f0f0",padding:"50px",textAlign:"center",marginBottom:"20px",borderRadius:"8px"},children:[t.jsx("img",{src:"/Hero-Logo.png",alt:"Hero Logo",style:{position:"absolute",left:"20px",top:"50%",transform:"translateY(-50%)",width:"200px"}}),t.jsx("h1",{style:{margin:0},children:t.jsxs("b",{children:["Engine Assembly Line Defect Monitoring System - Zone ",m||"-"]})}),t.jsx("img",{src:"/tnd_logo.png",alt:"Right Logo",style:{position:"absolute",right:"20px",top:"50%",transform:"translateY(-50%)",width:"150px"}})]}),t.jsx("div",{children:t.jsx("h2",{children:"Date"})}),t.jsx(N,{className:"g-4",children:f.length>0&&t.jsxs(T,{responsive:!0,striped:!0,bordered:!0,className:"custom-table",children:[t.jsx(R,{children:t.jsxs(j,{children:[t.jsx(l,{children:"Time"}),t.jsx(l,{children:"Defect Name / Defect Name Hindi"}),t.jsx(l,{children:"Operator Name"}),t.jsx(l,{children:"Today's Count"})]})}),t.jsx(k,{children:f.map((e,r)=>t.jsxs(j,{backgroundColor:!0,children:[t.jsx(u,{className:e.is_updated?"updated":"",style:{width:"10%",height:"100px",alignContent:"center",fontSize:"2rem",animationDuration:e.is_updated?`${c.current}s`:void 0,animationFillMode:"forwards"},children:y(e.updated_at)}),t.jsxs(u,{className:e.is_updated?"updated":"",style:{width:"70%",height:"100px",fontSize:"2rem",alignContent:"center",animationDuration:e.is_updated?`${c.current}s`:void 0,animationFillMode:"forwards"},children:[e.defect_name,"   /  ",e.defect_name_hi||"-"]}),t.jsx(u,{"defect-names":!0,className:e.is_updated?"updated":"",style:{width:"20%",height:"100px",fontSize:"2rem",alignContent:"center",animationDuration:e.is_updated?`${c.current}s`:void 0,animationFillMode:"forwards"},children:e.operator_name}),t.jsx(u,{className:e.is_updated?"updated":"",style:{height:"100px",fontSize:"2rem",alignContent:"center",animationDuration:e.is_updated?`${c.current}s`:void 0,animationFillMode:"forwards"},children:e.count||1})]},r))})]})})]})};export{W as default};
